//! ludorum-risky 0.0.1

(function(a){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],a):"object"==typeof exports&&module.exports?module.exports=a(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-risky"]=a(this.base,this.Sermat,this.ludorum)}).call(this,function a(b,c,d){"use strict";var e=b.declare,f=b.iterable,g=b.Iterable,h=b.raise,i=b.raiseIf,j=b.initialize,k=b.Randomness,l=d.Game,m=d.Player,n={__package__:"ludorum-risky",__name__:"ludorum_risky",__init__:a,__dependencies__:[b,c,d],__SERMAT__:{include:[b]}};n.attackProbabilities=function(a,c){var d={},e=function(a,b){return b-a};g.product.apply(g,g.repeat([1,2,3,4,5,6],a+c).toArray()).forEach(function(c){var f,g=c.slice(0,a).sort(e),h=c.slice(a).sort(e),i=0,j=0;b.iterable(g).zip(h).forEachApply(function(a,b){a>b?i++:j++}),f="A"+i+"D"+j,d[f]=(0|d[f])+1});var f=Math.pow(6,a+c);for(var h in d)d[h]=d[h]/f;return d};var o=n.ATTACK_PROBABILITIES={A1D1:{A1D0:.5833333333333334,A0D1:.4166666666666667},A1D2:{A1D0:.7453703703703703,A0D1:.25462962962962965},A2D1:{A1D0:.4212962962962963,A0D1:.5787037037037037},A2D2:{A1D1:.32407407407407407,A2D0:.44830246913580246,A0D2:.22762345679012347},A3D1:{A1D0:.3402777777777778,A0D1:.6597222222222222},A3D2:{A1D1:.3357767489711934,A2D0:.2925668724279835,A0D2:.37165637860082307}},p=e(d.aleatories.Aleatory,{constructor:function(a){i(a.length<1,"Aleatory cannot have an empty distribution!"),this.__distribution__=f(a)},distribution:function(){return this.__distribution__},value:function(a){return(a||k.DEFAULT).weightedChoice(this.__distribution__)},"static __SERMAT__":{identifier:"AttackAleatory",serializer:function(a){return[a.__distribution__.toArray()]}}}),q=n.ATTACK_ALEATORIES=f(o).mapApply(function(a,b){var c=f(b).mapApply(function(a,b){var c={attack:-(0|a.charAt(1)),defence:-(0|a.charAt(3))};return[c,b]});return[a,new p(c)]}).toObject(),r=n.conquestProbability=function x(a,b,c,d){if(c=c||s,d=d||o,a<1)return 0;if(b<1)return 1;var e="A"+a+"D"+b,f=c[e];return isNaN(f)?(f=1,1===b&&(1===a?f=d.A1D1.A1D0:2===a?f=d.A2D1.A1D0+d.A2D1.A0D1*x(a-1,b,c,d):a>=3&&(f=d.A3D1.A1D0+d.A3D1.A0D1*x(a-1,b,c,d))),2===b&&(1===a?f=d.A1D2.A1D0*x(a,b-1,c,d):2===a&&(f=d.A2D2.A2D0+d.A2D2.A1D1*x(a-1,b-1,c,d))),b>=3&&(1===a?f=d.A1D2.A1D0*x(a,b-1,c,d):2===a&&(f=d.A2D2.A2D0*x(a,b-2,c,d)+d.A2D2.A1D1*x(a-1,b-1,c,d))),a>=3&&b>=2&&(f=d.A3D2.A2D0*x(a,b-2,c,d)+d.A3D2.A0D2*x(a-2,b,c,d)+d.A3D2.A1D1*x(a-1,b-1,c,d)),c[e]=f,f):f},s=n.CONQUEST_PROBABILITIES=function(){var a={};return r(30,30,a,o),a}(),t=n.BoardMap=e({constructor:function(a,b,c){i(!a||Object.keys(a).length<2,"Illegal territory definition ",JSON.stringify(a),"!"),b=b||{},c=c||{},this.adjacents=Object.freeze(a),this.territories=Object.freeze(f(a).mapApply(function(b,c){return i(c.length<1,"Territory ",b," has no frontiers!"),c.forEach(function(c){i(!a.hasOwnProperty(c),"Territory ",b," has a frontier with an unknown territory ",c,"!"),i(b===c,"Territory ",b," has a frontier with itself!")}),b}).sorted().toArray()),this.territoryIndexes=Object.freeze(f(this.territories).map(function(a,b){return[a,b]}).toObject()),this.continentTerritories=Object.freeze(b),this.continents=Object.freeze(f(b).mapApply(function(b,c){return i(c.length<1,"Continent ",b," has no territories!"),c.forEach(function(c){i(!a.hasOwnProperty(c),"Continent ",b," has an unknown territory ",c,"!")}),b}).sorted().toArray()),f(c).forEachApply(function(a,c){i(!b.hasOwnProperty(a),"Bonus defined for unknown continent ",a,"!")}),this.bonuses=Object.freeze(c),Object.freeze(this)},territoryContinent:function(a){return f(this.continentTerritories).filterApply(function(b,c){var d=!1;return f(c).forEach(function(b){b===a&&(d=!0)}),d},function(a,b){return a}).toArray().toString()},adjacent:function(a,b){return this.adjacents[a]&&this.adjacents[a].indexOf(b)>=0},frontiers:function(){return f(this.adjacents).mapApply(function(a,b){return b.map(function(b){return[a,b]})}).flatten()},bonus:function(){for(var a=0,b=0;b<arguments.length;b++)a+=this.bonuses[arguments[b]]||0;return a},"static __SERMAT__":{identifier:"BoardMap",serializer:function(a){return[a.adjacents,a.continentTerritories,a.bonuses]}}}),u=n.MAPS={test01:new t({WhiteCountry:["BlackCountry","YellowCountry"],YellowCountry:["WhiteCountry","RedCountry"],RedCountry:["YellowCountry","GreenCountry"],GreenCountry:["RedCountry","BlueCountry"],BlueCountry:["GreenCountry","BlackCountry"],BlackCountry:["BlueCountry","WhiteCountry"]},{GreyContinent:["WhiteCountry","BlackCountry"],OrangeContinent:["YellowCountry","RedCountry"],CyanContinent:["GreenCountry","BlueCountry"]},{GreyContinent:2,OrangeContinent:2,CyanContinent:2}),classic:new t({Alaska:["Alberta","Northwest Territory","Kamchatka"],Alberta:["Alaska","Northwest Territory","Ontario","Western United States"],"Central America":["Eastern United States","Western United States","Venezuela"],"Eastern United States":["Alberta","Central America","Ontario","Quebec","Western United States"],Greenland:["Northwest Territory","Ontario","Quebec","Iceland"],"Northwest Territory":["Alaska","Alberta","Ontario","Greenland"],Ontario:["Alberta","Eastern United States","Greenland","Northwest Territory","Quebec","Western United States"],Quebec:["Eastern United States","Greenland","Ontario"],"Western United States":["Alberta","Central America","Eastern United States","Ontario"],Argentina:["Brazil","Peru"],Brazil:["Argentina","Peru","Venezuela","North Africa"],Peru:["Argentina","Brazil","Venezuela"],Venezuela:["Brazil","Peru","Central America"],"Great Britain":["Iceland","Northern Europe","Scandinavia","Western Europe"],Iceland:["Great Britain","Scandinavia","Greenland"],"Northern Europe":["Great Britain","Scandinavia","Southern Europe","Ukraine","Western Europe"],Scandinavia:["Great Britain","Iceland","Northern Europe","Ukraine"],"Southern Europe":["Northern Europe","Ukraine","Western Europe","Middle East","Egypt","North Africa"],Ukraine:["Northern Europe","Scandinavia","Southern Europe","Afghanistan","Middle East","Ural"],"Western Europe":["Great Britain","Northern Europe","Southern Europe","North Africa"],Congo:["East Africa","North Africa","South Africa"],"East Africa":["Congo","Egypt","Madagascar","North Africa","South Africa","Middle East"],Egypt:["East Africa","North Africa","Southern Europe","Middle East"],Madagascar:["East Africa","South Africa"],"North Africa":["Congo","East Africa","Egypt","Southern Europe","Western Europe","Brazil"],"South Africa":["Congo","East Africa","Madagascar"],Afghanistan:["China","India","Middle East","Ural","Ukraine"],China:["Afghanistan","India","Mongolia","Siam","Siberia","Ural"],India:["Afghanistan","China","Middle East","Siam"],Irkutsk:["Kamchatka","Mongolia","Siberia","Yakutsk"],Japan:["Kamchatka","Mongolia"],Kamchatka:["Irkutsk","Japan","Mongolia","Yakutsk","Alaska"],"Middle East":["Afghanistan","India","Southern Europe","Ukraine","East Africa","Egypt"],Mongolia:["China","Irkutsk","Japan","Kamchatka","Siberia"],Siam:["China","India","Indonesia"],Siberia:["China","Irkutsk","Mongolia","Ural","Yakutsk"],Ural:["Afghanistan","China","Siberia","Ukraine"],Yakutsk:["Irkutsk","Kamchatka","Siberia"],"Eastern Australia":["New Guinea","Western Australia"],Indonesia:["New Guinea","Western Australia","Siam"],"New Guinea":["Eastern Australia","Indonesia","Western Australia"],"Western Australia":["Eastern Australia","Indonesia","New Guinea"]},{"South America":["Argentina","Brazil","Peru","Venezuela"],Australia:["Eastern Australia","Indonesia","New Guinea","Western Australia"],Africa:["Congo","East Africa","Egypt","Madagascar","North Africa","South Africa"],Europe:["Great Britain","Iceland","Northern Europe","Scandinavia","Southern Europe","Ukraine","Western Europe"],"North America":["Alaska","Alberta","Central America","Eastern United States","Greenland","Northwest Territory","Ontario","Quebec","Western United States"],Asia:["Afghanistan","China","India","Irkutsk","Japan","Kamchatka","Middle East","Mongolia","Siam","Siberia","Ural","Yakutsk"]},{Asia:7,"North America":5,Europe:5,Africa:3,Australia:2,"South America":2})},v=n.Risk=e(l,{name:"Risk",players:["White","Yellow","Red","Green","Blue","Black"],STAGES:{REINFORCE:0,ATTACK:1,OCCUPY:2,FORTIFY:3},constructor:function(a){a=a||{},j(this,a).object("boardMap",{defaultValue:u.classic}).array("stage",{ignore:!0}).integer("round",{coerce:!0,defaultValue:0}).number("rounds",{coerce:!0,defaultValue:1/0}),l.call(this,a.activePlayer),a.armies?"string"==typeof a.armies?this.armies=a.armies:"object"==typeof a.armies?this.armies=this.compressGameState(a.armies):h("Invalid armies < ",JSON.stringify(a.armies)," >!"):this.armies=this.compressGameState(this.emptyGameState()),this.stage||(this.stage=[this.STAGES.REINFORCE,this.playerReinforcements()])},emptyGameState:function(){return f(this.boardMap.territories).map(function(a){return[a,["",0]]}).toObject()},compressGameState:function(a){var b=this.players,c=b.length;return this.boardMap.territories.map(function(d){var e=a[d][1];if(e>0){var f=b.indexOf(a[d][0]);i(f<0,"Unknown player '",a[d][0],"!"),e=e*c+f}return String.fromCharCode(e)}).join("")},uncompressGameState:function(a){var b={},c=this.players,d=c.length;return f(this.boardMap.territories).zip(a).forEachApply(function(a,e){e=e.charCodeAt(0),b[a]=e>0?[c[e%d],Math.floor(e/d)]:["",0]}),b},playerOf:function(a){var b=this.boardMap.territoryIndexes[a],c=this.armies.charCodeAt(b);return c?this.players[c%this.players.length]:""},armyCount:function(a){var b=this.boardMap.territoryIndexes[a],c=this.armies.charCodeAt(b);return c?Math.floor(c/this.players.length):0},playerTerritories:function(a){a=this.players.indexOf(a||this.activePlayer());var b=this.players.length;return f(this.boardMap.territories).zip(this.armies).filterApply(function(c,d){return d.charCodeAt(0)%b===a},function(a,b){return a}).toArray()},playerContinents:function(a){a=this.players.indexOf(a||this.activePlayer());var b=this.players.length,c=this.armies,d=this.boardMap.territoryIndexes;return f(this.boardMap.continentTerritories).filterApply(function(e,g){return f(g).all(function(e){return c.charCodeAt(d[e])%b===a})},function(a,b){return a}).toArray()},playerPendingTerritories:function(a){a=a||this.activePlayer();var b=this,c={};return f(this.boardMap.continentTerritories).forEachApply(function(d,e){var f=0;e.forEach(function(c){b.playerOf(c)!=a&&(f+=1)}),c[d]=f}),c},hasPresence:function(a,b){a=a||this.activePlayer();var c=this,d=!1;return f(this.boardMap.continentTerritories[b]).forEach(function(b){c.playerOf(b)===a&&(d=!0)}),d},continentAdyacent:function(a,b){a=a||this.activePlayer();var c=this,d=!1;return f(c.boardMap.continentTerritories[b]).forEach(function(b){c.conflictFrontiers(a).forEach(function(a){a[1]===b&&(d=!0)})}),d},playerReinforcements:function(a){a=a||this.activePlayer();var b=this.playerTerritories(a).length/3,c=this.boardMap.bonus.apply(this.boardMap,this.playerContinents(a));return Math.floor(Math.max(this.MIN_REINFORCEMENTS,b)+c)},MIN_REINFORCEMENTS:3,scores:function(){var a=this;return f(this.players).map(function(b){return[b,a.playerTerritories(b).length]}).toObject()},dominated:function(){for(var a,b=this.players.length,c=-1,d=0,e=this.armies.length;d<e;d++)if(a=this.armies.charCodeAt(d)%b,c!==a){if(!(c<0))return null;c=a}return this.players[c]},moreHalfDominated:function(){var a=Math.round(this.boardMap.territories.length/2),b=this.playerTerritories(this.activePlayer()).length;return b>a?this.activePlayer():null},result:function(){var a=this.__result__;if("undefined"==typeof a){var b=this.moreHalfDominated();if(b)a=this.victory(b,5);else if(this.round>=this.rounds){var c=this.scores(),d=this.players.slice().sort(function(a,b){return c[b]-c[a]});a=d[0]>d[1]?this.victory(d[0]):this.draw()}else a=null;this.__result__=a}return a},moves:function(){var a=this.__moves__;if("undefined"==typeof a){var b=this.activePlayer();if(this.result())a=null;else switch(a={},this.stage[0]){case this.STAGES.REINFORCE:a[b]=this.reinforceMoves();break;case this.STAGES.ATTACK:a[b]=this.attackMoves();break;case this.STAGES.OCCUPY:a[b]=this.occupyMoves();break;case this.STAGES.FORTIFY:a[b]=this.fortifyMoves();break;default:h("Invalid stage < ",JSON.stringify(this.stage)," >!")}this.__moves__=a}return a},reinforceMoves:function(){var a=this.activePlayer(),b=[];return this.stage[0]===this.STAGES.REINFORCE&&(b=g.product(["REINFORCE"],this.playerTerritories(a),g.range(1,this.stage[1]+1)).toArray()),b.length>0?b:[this.PASS_MOVE]},conflictFrontiers:function(a){a=a||this.activePlayer();var b=this;return f(this.boardMap.adjacents).mapApply(function(c,d){var e=b.playerOf(c);return e===a?f(d).filter(function(c){return b.playerOf(c)!==a},function(a){return[c,a]}):g.EMPTY}).flatten()},PASS_MOVE:["PASS"],attackMoves:function(){var a=this,b=[this.PASS_MOVE];return this.stage[0]===this.STAGES.ATTACK&&this.conflictFrontiers().forEach(function(c){for(var d=Math.min(a.MAX_ATTACK,a.armyCount(c[0])-1),e=1;e<=d;e++)b.push(["ATTACK",c[0],c[1],e])}),b},MAX_ATTACK:3,occupyMoves:function(){if(this.stage[0]===this.STAGES.OCCUPY){var a=this.stage[1];return g.range(1,this.armyCount(a)).map(function(a){return["OCCUPY",a]}).toArray()}return[]},fortifyMoves:function(){var a=[this.PASS_MOVE];if(this.stage[0]===this.STAGES.FORTIFY){var b=this,c=this.activePlayer();a=a.concat(f(this.boardMap.adjacents).mapApply(function(a,d){var e=b.playerOf(a),h=b.armyCount(a);return e===c&&h>1?f(d).filter(function(a){return b.playerOf(a)===c}).product(g.range(1,h)).mapApply(function(b,c){return["FORTIFY",a,b,c]}):g.EMPTY}).flatten().toArray())}return a},isValidReinforce:function(a,b){var c=this.stage;if(c[0]!==this.STAGES.REINFORCE)return b&&b("Cannot reinforce in this stage ("+c+")!"),!1;var d=c[1]-a[2];if(!Math.floor(d+1)||d<0||a[2]<1)return b&&b("Cannot reinforce "+a[2]+" armies!"),!1;var e=this.uncompressGameState(this.armies),f=this.activePlayer();return!(!e[a[1]]||e[a[1]][0]!==f)||(b&&b("Cannot reinforce territory "+a[1]+" because active player "+f+" does not own it!"),!1)},isValidAttack:function(a,b){var c=this.uncompressGameState(this.armies),d=this.stage,e=this.activePlayer();if(d[0]!==this.STAGES.ATTACK)return b&&b("Cannot attack in this stage ("+d+")!"),!1;if(!c[a[1]]||c[a[1]][0]!==e)return b&&b("Cannot attack from "+a[1]+"!"),!1;if(!c[a[2]]||c[a[2]][0]===e)return b&&b("Cannot attack to "+a[2]+"!"),!1;var f=c[a[1]][1]-a[3];return!(!Math.floor(f+1)||f<1||a[3]>3||a[3]<1)||(b&&b("Cannot attack with "+a[3]+" armies!"),!1)},isValidOccupy:function(a,b){var c=this.stage;if(c[0]!==this.STAGES.OCCUPY)return b&&b("Cannot occupy in this stage ("+c+")!"),!1;var d=this.uncompressGameState(this.armies),e=(this.activePlayer(),d[c[1]][1]-a[1]);return!(e<1||!Math.floor(a[1])||d[c[1]][1]<a[1]||a[1]<1)||(b&&b("Cannot occupy territory "+c[2]+" with "+a[1]+" armies!"),!1)},isValidFortify:function(a,b){var c=this.stage;if(c[0]!==this.STAGES.FORTIFY)return b&&b("Cannot fortify in this stage ("+c+")!"),!1;var d=this.uncompressGameState(this.armies),e=this.activePlayer();return d[a[1]]&&d[a[1]][0]===e?d[a[2]]&&d[a[2]][0]===e&&this.boardMap.adjacent(a[1],a[2])?!(!Math.floor(a[3])||a[3]<1||d[a[1]][1]<=a[3])||(b&&b("Cannot fortify with "+a[3]+" armies!"),!1):(b&&b("Cannot fortify to territory "+a[2]+"!"),!1):(b&&b("Cannot fortify from territory "+a[1]+"!"),!1)},next:function(a,b){var c=this.activePlayer(),d=a[c];switch(i(!d,"Active player has no moves!"),d[0]){case"REINFORCE":return this.nextReinforce(d);case"ATTACK":return this.nextAttack(d,b);case"OCCUPY":return this.nextOccupy(d);case"FORTIFY":return this.nextFortify(d);case"PASS":return this.nextPass(d);default:h("Invalid move < ",JSON.stringify(d)," >!")}},nextReinforce:function(a){if(this.isValidReinforce(a,h)){var b=this.stage,c=this.uncompressGameState(this.armies),d=b[1]-a[2],e=this.activePlayer();return c[a[1]][1]+=a[2],new this.constructor({boardMap:this.boardMap,stage:d>0?[this.STAGES.REINFORCE,d]:[this.STAGES.ATTACK],round:this.round,rounds:this.rounds,armies:c,activePlayer:e})}},nextAttack:function(a,c){var e=(this.stage,this.activePlayer());if(!c){var f="A"+a[3]+"D"+Math.min(2,this.armyCount(a[2])),g=q[f];return i(!g,"Could not find aleatory for ",f,"!"),new d.Contingent(this,b.obj(e,a),{rolls:g})}if(this.isValidAttack(a,h)){var j=this.uncompressGameState(this.armies);j[a[1]][1]+=c.rolls.attack,j[a[2]][1]+=c.rolls.defence;var k=j[a[2]][1]<1;return k&&(j[a[2]][0]=e),new this.constructor({boardMap:this.boardMap,stage:k?[this.STAGES.OCCUPY,a[1],a[2]]:this.stage,round:this.round,rounds:this.rounds,armies:j,activePlayer:this.activePlayer()})}},nextOccupy:function(a){if(this.isValidOccupy(a,h)){var b=this.stage,c=this.uncompressGameState(this.armies),d=this.activePlayer();return c[b[1]][1]-=a[1],c[b[2]]=[d,a[1]],new this.constructor({boardMap:this.boardMap,stage:[this.STAGES.ATTACK],round:this.round,rounds:this.rounds,armies:c,activePlayer:d})}},nextFortify:function(a){if(this.isValidFortify(a,h)){var b=this.uncompressGameState(this.armies),c=this.activePlayer();return b[a[1]][1]-=a[3],b[a[2]][1]+=a[3],new this.constructor(this.__advanceTurn__({boardMap:this.boardMap,stage:null,round:this.round,rounds:this.rounds,armies:b,activePlayer:c}))}},nextPass:function(a){var b={boardMap:this.boardMap,round:this.round,rounds:this.rounds,armies:this.armies,activePlayer:this.activePlayer()};switch(this.stage[0]){case this.STAGES.REINFORCE:b.stage=[this.STAGES.ATTACK];break;case this.STAGES.ATTACK:b.stage=[this.STAGES.FORTIFY];break;case this.STAGES.OCCUPY:h("Cannot pass!");break;case this.STAGES.FORTIFY:b=this.__advanceTurn__(b)}return new this.constructor(b)},__advanceTurn__:function(a){for(var b=(this.players.indexOf(a.activePlayer)+1)%this.players.length,c=0;c<this.players.length;c++){if(0===b&&a.round++,this.playerTerritories(this.players[b]).length>0){a.activePlayer=this.players[b];break}b=(b+1)%this.players.length}return a},"static __SERMAT__":{identifier:"Risk",serializer:function(a){return this.serializeAsProperties(a,["boardMap","stage","round","rounds","armies"],!0)}},"static armyAleatoryDistribution":function(a,b){var c={},d=b.territories,e=g.range(a.length).toArray(),f=e.slice();return d.forEach(function(b){f.length<1&&(f=e.slice());var d=Math.floor(Math.random()*f.length);c[b]=[a[f[d]],Math.floor(10*Math.random())+1],f.splice(d,1)}),c},"static armyDistribution":function(a,b){var c={},d=b.territories,e=g.range(a.length).toArray(),f=e.slice(),h=[20,20,20,20,20,20],i=6;return d.forEach(function(b){f.length<1&&(f=e.slice(),--i);var d=Math.floor(Math.random()*f.length);c[b]=[a[f[d]],Math.floor(Math.random()*(h[f[d]]-i))+1],h[f[d]]-=c[b][1],f.splice(d,1)}),c}}),w=n.players={};w.heuristics={territoryCount:function(a,b){return a.playerTerritories(b).length/a.boardMap.territories.length},continentCount:function(a,b){return a.playerContinents(b).length/a.boardMap.continents.length},territoryHeuristic:function(a,b){var c=a.uncompressGameState(a.armies),d={},e=0;f(c).forEachApply(function(a,b){d[b[0]]=(0|d[b[0]])+1,e++});var g=-(1/0),h=+(1/0),i=0;return f(d).forEachApply(function(a,b){g<b&&(g=b),h>b&&(h=b),i++}),g===h?0:((0|d[b])-e/i)/(g-h)},heuristicPru:function(a,b){return(4*a.playerContinents(b).length+a.playerTerritories(b).length)/(4*a.boardMap.continents.length+a.boardMap.territories.length)},heuristicReinforcements:function(a,b){return a.playerReinforcements(b)/38-.5},heuristicConquestProbability:function(a,b){var c=0;return a.conflictFrontiers(b).mapApply(function(b,d){var e=a.armyCount(b),f=a.armyCount(d);return c++,r(e,f)-r(f,e)}).sum()/c},heuristic2:function(a,b){var c=.8;return c*v.heuristics.heuristicPru(a,b)+(1-c)*v.heuristics.heuristicConquestProbability(a,b)}},w.RiskSimplePlayer=e(m,{constructor:function(a){m.call(this,a),this.random=a.random||k.DEFAULT},decision:function(a,b){a.moves()[b],this.random;switch(a.stage[0]){case a.STAGES.REINFORCE:return this.decisionReinforce(a,b);case a.STAGES.ATTACK:return this.decisionAttack(a,b);case a.STAGES.OCCUPY:return this.decisionOccupy(a,b);case a.STAGES.FORTIFY:return this.decisionFortify(a,b)}h("Unsupported stage ",a.stage[0],"!")},decisionReinforce:function(a,b){var c=a.moves()[b],d=this.random,e={};return a.conflictFrontiers(b).forEachApply(function(a,b){e[a]=(0|e[a])+1}),c=c.filter(function(a){return e.hasOwnProperty(a[1])}),c.sort(function(a,b){return e[b]-e[a]}),c[Math.min(d.randomInt(c.length),d.randomInt(c.length))]},decisionAttack:function(a,b){var c=a.moves()[b],d=this.random;return c=c.filter(function(b){return"ATTACK"===b[0]&&b[3]===a.MAX_ATTACK}),d.choice(c)||a.PASS_MOVE},decisionOccupy:function(a,b){var c=a.moves()[b],d=f(c).select(1).max();return d<2?c[0]:["OCCUPY",d-1]},decisionFortify:function(a,b){var c=a.moves()[b],d=this.random;return c=c.filter(function(b){return"FORTIFY"===b[0]&&a.armyCount(b[1])-b[3]>=a.armyCount(b[2])}),c.sort(function(a,b){return b[3]-a[3]}),c.length<1?a.PASS_MOVE:c[Math.min(d.randomInt(c.length),d.randomInt(c.length))]},"static __SERMAT__":{identifier:"RiskSimplePlayer",serializer:function(a){var b=m.__SERMAT__.serializer(a),c=b[0];return c.random=a.random,b}}}),w.RiskContinentPlayer=e(m,{constructor:function(a){a=a||{},m.call(this,a),this.random=a.random||k.DEFAULT},decision:function(a,b){a.moves()[b],this.random;switch(a.stage[0]){case a.STAGES.REINFORCE:return this.decisionReinforce(a,b);case a.STAGES.ATTACK:return this.decisionAttack(a,b);case a.STAGES.OCCUPY:return this.decisionOccupy(a,b);case a.STAGES.FORTIFY:return this.decisionFortify(a,b)}h("Unsupported stage ",a.stage[0],"!")},targetContinent:function(a,b){var c="",d=13;return f(a.playerPendingTerritories(b)).forEachApply(function(e,f){0!==f&&f<d&&a.continentAdyacent(b,e)&&(d=f,c=e)}),c},decisionReinforce:function(a,b){var c=a.moves()[b],d=this.random,e={},f=this.targetContinent(a,b);return a.conflictFrontiers(b).forEachApply(function(b,c){a.boardMap.territoryContinent(c)===f&&(e[b]=(0|e[b])+1)}),c=c.filter(function(a){return e.hasOwnProperty(a[1])}),c.sort(function(a,b){return e[b]-e[a]}),c[Math.min(d.randomInt(c.length),d.randomInt(c.length))]},decisionAttack:function(a,b){var c=a.moves()[b],d=this.random,e=this.targetContinent(a,b);return c=c.filter(function(b){return"ATTACK"===b[0]&&b[3]===a.MAX_ATTACK&&a.boardMap.territoryContinent(b[2])===e||r(a.armyCount(b[1]),a.armyCount(b[2])>.75)}),d.choice(c)||a.PASS_MOVE},decisionOccupy:function(a,b){var c=a.moves()[b],d=f(c).select(1).max();return d<2?c[0]:["OCCUPY",d-1]},decisionFortify:function(a,b){return["PASS"]},"static __SERMAT__":{identifier:"RiskContinentPlayer",serializer:function(a){var b=m.__SERMAT__.serializer(a),c=b[0];return c.random=a.random,b}}});n.scenarios=function(){var a=function(a,b){return[a,0|b]},b=a.bind(null,"White"),c=a.bind(null,"Yellow"),d=a.bind(null,"Red"),e=a.bind(null,"Blue"),h=a.bind(null,"Green"),i=a.bind(null,"Black");return f({whiteOceania:[h(12),i(12),e(12),d(9),h(2),c(12),b(6),i(2),e(1),b(1),h(2),c(2),e(1),d(2),e(3),b(6),b(1),c(1),i(2),h(1),i(1),c(2),d(4),b(1),d(1),e(1),e(1),i(1),h(1),c(1),h(1),b(4),c(1),d(1),e(1),i(1),d(1),i(1),b(1),c(1),d(2),h(1)],blackOceania:[h(12),b(12),e(12),d(9),h(2),c(12),i(6),b(2),e(1),i(1),h(2),c(2),e(1),d(2),e(3),i(6),i(1),c(1),b(2),h(1),b(1),c(2),d(4),i(1),d(1),e(1),e(1),b(1),h(1),c(1),h(1),i(4),c(1),d(1),e(1),b(1),d(1),b(1),i(1),c(1),d(2),h(1)],whiteAfrica:[h(12),i(12),e(12),d(9),b(5),c(12),i(2),b(1),b(4),e(1),h(2),b(5),e(1),d(2),e(3),c(2),i(1),c(1),i(2),h(1),b(1),c(2),d(4),d(1),b(3),e(1),e(1),i(1),h(1),c(1),h(1),h(2),c(1),b(1),e(1),i(1),d(1),i(1),d(1),c(1),d(2),h(1)],blackAfrica:[h(12),b(12),e(12),d(9),i(5),c(12),b(2),i(1),i(4),e(1),h(2),i(5),e(1),d(2),e(3),c(2),b(1),c(1),b(2),h(1),i(1),c(2),d(4),d(1),i(3),e(1),e(1),b(1),h(1),c(1),h(1),h(2),c(1),i(1),e(1),b(1),d(1),b(1),d(1),c(1),d(2),h(1)],spreadOut:[c(3),b(3),b(3),b(2),h(3),e(2),b(4),e(3),c(4),h(2),i(6),d(3),d(4),b(1),d(2),c(3),h(4),b(5),h(4),d(3),d(2),c(3),i(5),i(3),i(2),h(1),c(2),c(2),e(2),h(4),e(3),c(3),i(1),d(3),i(1),e(3),h(2),b(2),d(3),e(3),e(4),i(2)],spreadOutBlack:[c(3),i(3),i(3),i(2),h(3),e(2),i(4),e(3),c(4),h(2),b(6),d(3),d(4),i(1),d(2),c(3),h(4),i(5),h(4),d(3),d(2),c(3),b(5),b(3),b(2),h(1),c(2),c(2),e(2),h(4),e(3),c(3),b(1),d(3),b(1),e(3),h(2),i(2),d(3),e(3),e(4),b(2)],spreadOutV2:[i(3),c(3),e(3),h(2),d(3),i(3),c(3),b(3),h(3),i(4),c(3),c(3),b(3),e(3),d(3),e(3),h(5),d(3),i(1),h(3),d(2),b(3),b(1),b(5),i(3),h(3),i(3),h(3),b(2),b(3),i(3),d(3),h(1),e(2),e(3),d(3),e(3),e(3),c(4),c(3),d(3),c(1)],spreadOute1:[b(3),d(2),c(4),e(3),h(2),d(2),d(4),i(2),d(5),c(3),b(4),i(2),c(2),d(1),h(3),d(4),i(3),c(3),b(2),b(4),c(1),h(1),e(1),e(4),c(3),i(2),h(4),d(2),i(3),h(4),e(4),i(4),h(3),h(3),b(2),e(3),i(4),b(1),e(2),e(3),c(4),b(4)],whiteSpreadOut:[e(1),i(1),i(2),c(1),c(1),c(12),h(1),c(2),e(1),b(1),b(6),e(12),d(1),b(1),d(1),e(1),h(2),i(2),b(1),i(12),e(1),e(3),h(1),h(2),c(2),b(4),i(1),i(1),b(1),i(1),d(4),h(1),h(12),e(1),d(2),d(9),d(1),c(1),h(1),d(2),c(1),b(6)],blackSpreadOut:[e(1),b(1),b(2),c(1),c(1),c(12),h(1),c(2),e(1),i(1),i(6),e(12),d(1),i(1),d(1),e(1),h(2),b(2),i(1),b(12),e(1),e(3),h(1),h(2),c(2),i(4),b(1),b(1),i(1),b(1),d(4),h(1),h(12),e(1),d(2),d(9),d(1),c(1),h(1),d(2),c(1),i(6)],allTotalitiesButWhite:[b(6),i(5),i(2),c(1),c(7),c(2),h(1),e(1),e(1),h(1),i(5),e(6),d(1),b(1),d(4),h(1),h(3),b(1),b(1),c(1),e(1),e(3),c(2),h(3),e(7),d(1),i(1),i(1),c(1),i(1),d(4),h(10),b(1),e(1),d(2),d(6),b(4),c(6),h(1),d(2),i(5),b(6)],allTotalitiesButBlack:[i(6),b(5),b(2),c(1),c(7),c(2),h(1),e(1),e(1),h(1),b(5),e(6),d(1),i(1),d(4),h(1),h(3),i(1),i(1),c(1),e(1),e(3),c(2),h(3),e(7),d(1),b(1),b(1),c(1),b(1),d(4),h(10),i(1),e(1),d(2),d(6),i(4),c(6),h(1),d(2),b(5),i(6)]}).mapApply(function(a,b){return[a,g.zip(u.classic.territories,b).toObject()]}).toObject()}();return[t,v,w.RiskContinentPlayer,p].forEach(function(a){a.__SERMAT__.identifier=n.__package__+"."+a.__SERMAT__.identifier,n.__SERMAT__.include.push(a)}),c.include(n),n});
//# sourceMappingURL=ludorum-risky.min.js.map